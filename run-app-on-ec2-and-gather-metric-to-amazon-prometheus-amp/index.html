<!doctype html>
<!--
  Minimal Mistakes Jekyll Theme 4.19.3 by Michael Rose
  Copyright 2013-2019 Michael Rose - mademistakes.com | @mmistakes
  Free for personal and commercial use under the MIT license
  https://github.com/mmistakes/minimal-mistakes/blob/master/LICENSE
-->
<html lang="en" class="no-js">
  <head>
    <meta charset="utf-8">

<!-- begin _includes/seo.html --><title>Run application on EC2 and gather metric to Amazon Managed Service for Prometheus (Amazon Prometheus / AMP) - Continuous Improvement</title>
<meta name="description" content="In this article, it shows a example to use Amazon Managed Service for Prometheus (AMP) to gather metrics when running standalone application on EC2 instance, rather than having Kubernetes to deploy. Giving the overview and share some tips you have to know if you are trying to push metrics to AMP.">


  <meta name="author" content="Yang-Xin Cao (Eason Cao)">


<meta property="og:type" content="article">
<meta property="og:locale" content="en_US">
<meta property="og:site_name" content="Continuous Improvement">
<meta property="og:title" content="Run application on EC2 and gather metric to Amazon Managed Service for Prometheus (Amazon Prometheus / AMP)">
<meta property="og:url" content="https://easoncao.com/run-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp/">


  <meta property="og:description" content="In this article, it shows a example to use Amazon Managed Service for Prometheus (AMP) to gather metrics when running standalone application on EC2 instance, rather than having Kubernetes to deploy. Giving the overview and share some tips you have to know if you are trying to push metrics to AMP.">



  <meta property="og:image" content="https://easoncao.com/assets/images/posts/2021/02/run-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp/ec2-with-amp-overview.png">





  <meta property="article:published_time" content="2021-02-01T00:00:00+00:00">





  

  


<link rel="canonical" href="https://easoncao.com/run-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp/">




<script type="application/ld+json">
  {
    "@context": "https://schema.org",
    
      "@type": "Person",
      "name": "Continuous Improvement",
      "url": "https://easoncao.com/"
    
  }
</script>






<!-- end _includes/seo.html -->


<link href="/feed.xml" type="application/atom+xml" rel="alternate" title="Continuous Improvement Feed">

<!-- https://t.co/dKP3o1e -->
<meta name="viewport" content="width=device-width, initial-scale=1.0">

<script>
  document.documentElement.className = document.documentElement.className.replace(/\bno-js\b/g, '') + ' js ';
</script>

<!-- Google adsense -->
<script data-ad-client="ca-pub-1852752964062281" async src="https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js"></script>

<!-- For all browsers -->
<link rel="stylesheet" href="/assets/css/main.css">
<link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/@fortawesome/fontawesome-free@5/css/all.min.css">

<!--[if IE]>
  <style>
    /* old IE unsupported flexbox fixes */
    .greedy-nav .site-title {
      padding-right: 3em;
    }
    .greedy-nav button {
      position: absolute;
      top: 0;
      right: 0;
      height: 100%;
    }
  </style>
<![endif]-->



    <!-- start custom head snippets -->

<!-- insert favicons. use https://realfavicongenerator.net/ -->

<link rel="shortcut icon" type="image/jpg" href="/assets/apple-touch-icon.png"/>

<!-- end custom head snippets -->

  </head>

  <body class="layout--single wide">
    <nav class="skip-links">
  <h2 class="screen-reader-text">Skip links</h2>
  <ul>
    <li><a href="#site-nav" class="screen-reader-shortcut">Skip to primary navigation</a></li>
    <li><a href="#main" class="screen-reader-shortcut">Skip to content</a></li>
    <li><a href="#footer" class="screen-reader-shortcut">Skip to footer</a></li>
  </ul>
</nav>

    <!--[if lt IE 9]>
<div class="notice--danger align-center" style="margin: 0;">You are using an <strong>outdated</strong> browser. Please <a href="https://browsehappy.com/">upgrade your browser</a> to improve your experience.</div>
<![endif]-->

    

<div class="masthead">
  <div class="masthead__inner-wrap">
    <div class="masthead__menu">
      <nav id="site-nav" class="greedy-nav">
        
          <a class="site-logo" href="/"><img src="/assets/apple-touch-icon.png" alt=""></a>
        
        <a class="site-title" href="/">
          Continuous Improvement
          <span class="site-subtitle"></span>
        </a>
        <ul class="visible-links"><li class="masthead__menu-item">
              <a href="/posts/">所有文章 All Posts</a>
            </li><li class="masthead__menu-item">
              <a href="/about/">關於 About</a>
            </li></ul>
        
        <button class="search__toggle" type="button">
          <span class="visually-hidden">Toggle search</span>
          <svg class="icon" width="16" height="16" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 15.99 16">
            <path d="M15.5,13.12L13.19,10.8a1.69,1.69,0,0,0-1.28-.55l-0.06-.06A6.5,6.5,0,0,0,5.77,0,6.5,6.5,0,0,0,2.46,11.59a6.47,6.47,0,0,0,7.74.26l0.05,0.05a1.65,1.65,0,0,0,.5,1.24l2.38,2.38A1.68,1.68,0,0,0,15.5,13.12ZM6.4,2A4.41,4.41,0,1,1,2,6.4,4.43,4.43,0,0,1,6.4,2Z" transform="translate(-.01)"></path>
          </svg>
        </button>
        
        <button class="greedy-nav__toggle hidden" type="button">
          <span class="visually-hidden">Toggle menu</span>
          <div class="navicon"></div>
        </button>
        <ul class="hidden-links hidden"></ul>
      </nav>
    </div>
  </div>
</div>


    <div class="initial-content">
      



<div id="main" role="main">
  
  <div class="sidebar sticky">
  


<div itemscope itemtype="https://schema.org/Person">

  
    <div class="author__avatar">
      
        <img src="https://www.gravatar.com/avatar/fe7378c666bdc7da319af36e512d669b?s=200" alt="Yang-Xin Cao (Eason Cao)" itemprop="image">
      
    </div>
  

  <div class="author__content">
    
      <h3 class="author__name" itemprop="name">Yang-Xin Cao (Eason Cao)</h3>
    
    
      <div class="author__bio" itemprop="description">
        <p>Engineer@Amazon <br />- <a href="https://www.awshof.com/allstarscertifiedlist.html">AWS All-5 certified</a> / ECS &amp; EKS SME / Marathon Runner / PADI Open Water Diver</p>

      </div>
    
  </div>

  <div class="author__urls-wrapper">
    <button class="btn btn--inverse">Follow</button>
    <ul class="author__urls social-icons">
      
        <li itemprop="homeLocation" itemscope itemtype="https://schema.org/Place">
          <i class="fas fa-fw fa-map-marker-alt" aria-hidden="true"></i> <span itemprop="name">Amazon / Taipei, Taiwan</span>
        </li>
      

      
        
          
            <li><a href="eason@easoncao.com" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-envelope-square" aria-hidden="true"></i><span class="label">Email</span></a></li>
          
        
          
            <li><a href="https://linkedin.com/in/easoncao" rel="nofollow noopener noreferrer"><i class="fas fa-fw fa-linkedin" aria-hidden="true"></i><span class="label">LinkedIn</span></a></li>
          
        
          
        
          
        
          
            <li><a href="https://github.com/0xlen" rel="nofollow noopener noreferrer"><i class="fab fa-fw fa-github" aria-hidden="true"></i><span class="label">GitHub</span></a></li>
          
        
          
        
      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      

      <!--
  <li>
    <a href="http://link-to-whatever-social-network.com/user/" itemprop="sameAs" rel="nofollow noopener noreferrer">
      <i class="fas fa-fw" aria-hidden="true"></i> Custom Social Profile Link
    </a>
  </li>
-->
    </ul>
  </div>
</div>

  
  </div>



  <article class="page" itemscope itemtype="https://schema.org/CreativeWork">
    <meta itemprop="headline" content="Run application on EC2 and gather metric to Amazon Managed Service for Prometheus (Amazon Prometheus / AMP)">
    <meta itemprop="description" content="What’s Amazon Managed Service for Prometheus (Amazon Prometheus / AMP)">
    <meta itemprop="datePublished" content="2021-02-01T00:00:00+00:00">
    

    <div class="page__inner-wrap">
      
        <header>
          <h1 id="page-title" class="page__title" itemprop="headline">Run application on EC2 and gather metric to Amazon Managed Service for Prometheus (Amazon Prometheus / AMP)
</h1>
          
            <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  10 minute read

</p>
          
        </header>
      

      <!-- Google ads in article -->
      <div>
          <ins class="adsbygoogle"
               style="display:block; text-align:center;"
               data-ad-layout="in-article"
               data-ad-format="fluid"
               data-ad-client="ca-pub-1852752964062281"
               data-ad-slot="8435469231"></ins>
          <script>
               (adsbygoogle = window.adsbygoogle || []).push({});
          </script>
      </div>
      <hr>

      <section class="page__content" itemprop="text">
        
          <aside class="sidebar__right ">
            <nav class="toc">
              <header><h4 class="nav__title"><i class="fas fa-cog"></i> Table of Contents</h4></header>
              <ul class="toc__menu">
  <li><a href="#whats-amazon-managed-service-for-prometheus-amazon-prometheus--amp">What’s Amazon Managed Service for Prometheus (Amazon Prometheus / AMP)</a></li>
  <li><a href="#what-if-i-would-like-to-gather-metric-without-having-kubernetesecs-cluster">What if I would like to gather metric without having Kubernetes/ECS cluster?</a></li>
  <li><a href="#overview">Overview</a></li>
  <li><a href="#configuration-steps">Configuration steps</a>
    <ul>
      <li><a href="#1-create-a-workspace-in-amazon-prometheus-amp">1) Create a workspace in Amazon Prometheus (AMP)</a></li>
      <li><a href="#2-set-up-iam-userrole-permission-for-your-grafana-dashboard">2) Set up IAM user/role permission for your Grafana dashboard</a></li>
      <li><a href="#3-run-grafana-dashboard-on-my-monitoring-server-ec2-instance-a">3) Run Grafana dashboard on my monitoring server (EC2 instance A)</a></li>
      <li><a href="#4-on-application-server-ec2-instance-b-with-private-ip-address-1723121133">4) On application server (EC2 instance B, with private IP address: 172.31.21.133)</a></li>
      <li><a href="#5-set-up-the-prometheus-server-to-collect-metrics">5) Set up the Prometheus server to collect metrics</a></li>
      <li><a href="#5-view-the-metric-">5) View the metric !</a></li>
    </ul>
  </li>
  <li><a href="#troubleshooting">Troubleshooting</a>
    <ul>
      <li><a href="#how-to-use-curl-to-query-my-amazon-prometheus-to-check-if-the-connectivity-or-iam-authentication-is-working-or-not">How to use curl to query my Amazon Prometheus to check if the connectivity, or, IAM authentication is working or not?</a></li>
    </ul>
  </li>
  <li><a href="#conclusion">Conclusion</a></li>
  <li><a href="#references">References</a></li>
</ul>

            </nav>
          </aside>
        
        <h2 id="whats-amazon-managed-service-for-prometheus-amazon-prometheus--amp">What’s Amazon Managed Service for Prometheus (Amazon Prometheus / AMP)</h2>

<blockquote>
  <p>Amazon Managed Service for Prometheus is a serverless, Prometheus-compatible monitoring service for container metrics that makes it easier to securely monitor container environments at scale. With AMP, you can use the same open-source Prometheus data model and query language that you use today to monitor the performance of your containerized workloads, and also enjoy improved scalability, availability, and security without having to manage the underlying infrastructure. <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/what-is-Amazon-Managed-Service-Prometheus.html">source</a></p>
</blockquote>

<p>There has a good article was dscribing the service feature on AWS Blog Post:</p>

<ul>
  <li><a href="https://aws.amazon.com/blogs/mt/getting-started-amazon-managed-service-for-prometheus/">Getting Started with Amazon Managed Service for Prometheus</a></li>
</ul>

<h2 id="what-if-i-would-like-to-gather-metric-without-having-kubernetesecs-cluster">What if I would like to gather metric without having Kubernetes/ECS cluster?</h2>

<p>The most of example was using EKS/ECS or Kubernetes Cluster as example. What if I would like to simply gather metrics for my application and got benefit without managing Prometheus so AWS would ensure the high availability? Generally, the idea is simple, however, it still takes me some times to do some research and get it a try. So it inspired me to write down the detail steps here.</p>

<p>If you would like to , you should have:</p>

<ul>
  <li>Application: Your application should follow the data model that supported by Prometheus (e.g. <code class="language-plaintext highlighter-rouge">go_gc_duration_seconds_count 62</code>) and expose your metrics with HTTP server, end with path <code class="language-plaintext highlighter-rouge">/metrics</code>.</li>
  <li>AWS SigV4 Proxy: By default, when using <code class="language-plaintext highlighter-rouge">remote_write</code> supported  The AWS SigV4 Proxy will sign incoming HTTP requests and forward them to the host specified in the Host header.</li>
  <li>Standard Prometheus Server (or other agent to gather metrics): The Prometheus Server requires to be installed so it can from your application (<code class="language-plaintext highlighter-rouge">/metrics</code>) and ship metric to the URL as specified in <code class="language-plaintext highlighter-rouge">remote_write</code> section.</li>
</ul>

<h2 id="overview">Overview</h2>

<figure class="">
  <img src="/assets/images/posts/2021/02/run-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp/ec2-with-amp-overview.png" alt="Architecture overview" />
  
    <figcaption>
      Architecture overview

    </figcaption>
  
</figure>

<ul>
  <li>Monitoring Server (let’s say it is <strong>EC2 instance A</strong>): This instance is running Grafana dashboard to see my metrics</li>
  <li>Application Server (let’s say it is <strong>EC2 instance B</strong>): The instance is running my application and standard Prometheus(gathering metrics)</li>
  <li>A Workspaces in my Amazon Prometheus (AMP) in <code class="language-plaintext highlighter-rouge">us-east-1</code>: Used to receive metrics and provide consist readable endpoint so Grafana was able to query metrics</li>
</ul>

<h2 id="configuration-steps">Configuration steps</h2>

<p>To demonstrate the entire working flow, I am going to use several docker images to quickly show how to do that. If you requires to run standalone application, you can use those Docker images, or build the binary by yourself by referencing the Dockerfile and documentations.</p>

<ul>
  <li><a href="https://hub.docker.com/r/prom/prometheus/">prom/prometheus</a>: Standard Prometheus container image, binaries can be found on <a href="https://prometheus.io/download/">official documentation here</a>.</li>
  <li><a href="https://hub.docker.com/r/grafana/grafana/">grafana/grafana</a>: Grafana dashboard</li>
  <li><a href="https://github.com/sysdiglabs/custom-metrics-examples">prometheus-golang</a>: Sample application from sysdig for Prometheus metrics. (<a href="https://sysdig.com/blog/prometheus-metrics/">Source</a>)</li>
  <li><a href="https://github.com/awslabs/aws-sigv4-proxy">public.ecr.aws/aws-observability/aws-sigv4-proxy</a>: AWS SigV4 Proxy to sign incoming HTTP requests and forward them</li>
</ul>

<h3 id="1-create-a-workspace-in-amazon-prometheus-amp">1) Create a workspace in Amazon Prometheus (AMP)</h3>

<p>If you got the preview access, the first step is to create a workspace in Amazon Prometheus:</p>

<figure class="">
  <img src="/assets/images/posts/2021/02/run-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp/create-workspace-in-amp.png" alt="Create a workspace in AMP" />
  
    <figcaption>
      Create a workspace in AMP

    </figcaption>
  
</figure>

<p>So far it is simple and you can easily click one button to complete the creation. It usually takes few minutes as it was doing provisioning in the backend.</p>

<h3 id="2-set-up-iam-userrole-permission-for-your-grafana-dashboard">2) Set up IAM user/role permission for your Grafana dashboard</h3>

<p>Access to Amazon Managed Service for Prometheus actions and data requires credentials as AMP is using IAM for ensuing the data security. Therefore, it is required to have SigV4/IAM authentication when accessing the endpoint as it provides a consistent query endpoint for your AMP resource once you created a workspace. For example, the AMP resource in <code class="language-plaintext highlighter-rouge">us-east-1</code> region can provide endpoint below:</p>

<ul>
  <li>https://aps-workspaces.us-east-1.amazonaws.com/workspaces/ws-XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX/api/v1/query</li>
</ul>

<p>When adding the data source in my Grafana dashboard, it needs to follow the authentication model to access the data. To provide the access for my dashboard, in the example, I simply created a IAM user(<code class="language-plaintext highlighter-rouge">amp-gra-user</code>) with plain Access Key &amp; Secret Key. To esnure it has permission to access AMP resource, I attached managed policy <code class="language-plaintext highlighter-rouge">AmazonPrometheusQueryAccess</code> with following rules to provide readable access:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"aps:GetLabels"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"aps:GetMetricMetadata"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"aps:GetSeries"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"aps:QueryMetrics"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<figure class="">
  <img src="/assets/images/posts/2021/02/run-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp/create-iam-user-for-grafana-dashboard.png" alt="Create an IAM User for Grafana dashboard" />
  
    <figcaption>
      Create an IAM User for Grafana dashboard

    </figcaption>
  
</figure>

<p>You still can use IAM role/attached EC2 IAM role as Grafana generally can use those permission if enabled loading AWS SDK config, as in my next step.</p>

<p>As the managed policy might be changed once the service is generally available (GA), please refer to the Amazon Prometheus document - <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-and-IAM.html">IAM permissions and policies</a> to get more detail.</p>

<h3 id="3-run-grafana-dashboard-on-my-monitoring-server-ec2-instance-a">3) Run Grafana dashboard on my monitoring server (EC2 instance A)</h3>

<p>This step I used Docker to run my Grafana dashboard. As Amazon Managed Service for Prometheus is integrated with AWS Identity and Access Management (IAM) to ensure that all calls to Prometheus APIs, such as query and ingest, are secured with IAM credentials.</p>

<blockquote>
  <p>By default, the Prometheus data source in Grafana assumes that Prometheus requires no authentication. To enable Grafana to take advantage of AMP authentication and authorization capabilities, you will need to enable SigV4 authentication support in the Grafana data source. <a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-onboard-query-standalone-grafana.html#AMP-onboard-standalone-grafana-sigv4">Reference</a></p>
</blockquote>

<p>To enable SigV4 on Grafana, I run my Grafana with the <code class="language-plaintext highlighter-rouge">AWS_SDK_LOAD_CONFIG</code> and <code class="language-plaintext highlighter-rouge">GF_AUTH_SIGV4_AUTH_ENABLED</code> environment variables set to <code class="language-plaintext highlighter-rouge">true</code>. The GF_AUTH_SIGV4_AUTH_ENABLED environment variable overrides the default configuration for Grafana to enable SigV4 support. <a href="https://grafana.com/docs/grafana/latest/administration/configuration/#sigv4_auth_enabled">sigv4_auth_enabled</a></p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="se">\</span>
    <span class="nt">-p</span> 3000:3000 <span class="se">\</span>
    <span class="nt">--name</span><span class="o">=</span>grafana <span class="se">\</span>
    <span class="nt">-e</span> <span class="s2">"GF_AUTH_SIGV4_AUTH_ENABLED=true"</span> <span class="se">\</span>
    <span class="nt">-e</span> <span class="s2">"AWS_SDK_LOAD_CONFIG=true"</span> <span class="se">\</span>
    grafana/grafana
</code></pre></div></div>

<p>Once the Grafana is up and running, the next thing is that go to the AMP console then copy and paste the endpoint URL in your Grafana. You can find section <strong>Endpoint - remote write URL</strong> &amp; <strong>Endpoint - query URL</strong> in the console:</p>

<figure class="">
  <img src="/assets/images/posts/2021/02/run-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp/amp-endpoints.png" alt="Endpoints in AMP console" />
  
    <figcaption>
      Endpoints in AMP console

    </figcaption>
  
</figure>

<p>The Grafana requires to use <strong>query URL</strong> to read the metric, so go to the Grafana Dashboard and add a new Data Source. You can find the setting in the left navigation bar:</p>

<figure class="">
  <img src="/assets/images/posts/2021/02/run-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp/grafana-configuration.png" alt="Grafana Configurations" />
  
    <figcaption>
      Grafana Configurations

    </figcaption>
  
</figure>

<p>Select ‘Prometheus’ as new data source to add, fill the several information as below:</p>

<figure class="">
  <img src="/assets/images/posts/2021/02/run-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp/grafana-add-data-source.png" alt="Grafana add data source" />
  
    <figcaption>
      Grafana add data source

    </figcaption>
  
</figure>

<ul>
  <li><strong>HTTP &gt; URL</strong>: fill the endpoint URL you just copied (<strong>Endpoint - query URL</strong>), please remove the <code class="language-plaintext highlighter-rouge">/api/v1/query</code> string that is appended to the URL, because the Prometheus data source will automatically append it. For example:
    <ul>
      <li>Endpoint (query URL): <code class="language-plaintext highlighter-rouge">https://aps-workspaces.us-east-1.amazonaws.com/workspaces/ws-XXXXX-XXXX-XXX-XXXX-XXXXXX</code></li>
    </ul>
  </li>
  <li><strong>Auth &gt; SigV4 auth</strong>: Enable the selection</li>
  <li><strong>SigV4 Auth Details</strong>: Select <code class="language-plaintext highlighter-rouge">Authentication Provider</code> (Using Access &amp; Secret key or else). In my testing I was filling <code class="language-plaintext highlighter-rouge">Access Key ID</code> &amp; <code class="language-plaintext highlighter-rouge">Secret Access Key</code> with the credential of my IAM User (<code class="language-plaintext highlighter-rouge">amp-gra-user</code>).</li>
</ul>

<p>Then click <strong>Save &amp; Test</strong>, if everything works fine, you will see the message <code class="language-plaintext highlighter-rouge">Data source is working</code>:</p>

<figure class="">
  <img src="/assets/images/posts/2021/02/run-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp/data-source-is-working.png" alt="Data source is working" />
  
    <figcaption>
      Data source is working

    </figcaption>
  
</figure>

<p>If not and shows other error messages, please refer to the following documentation to do troubleshooting:</p>

<ul>
  <li><a href="https://docs.aws.amazon.com/prometheus/latest/userguide/AMP-onboard-query-standalone-grafana.html#AMP-onboard-standalone-grafana-troubleshoot">Set up Grafana open source or Grafana Enterprise for use with AMP - Troubleshooting if Save &amp; Test doesn’t work</a></li>
</ul>

<p>At this step we can ensure Grafana can query our metrics on AMP, but there has no data point yet, so the next step is to gather and write metrics to AMP.</p>

<h3 id="4-on-application-server-ec2-instance-b-with-private-ip-address-1723121133">4) On application server (EC2 instance B, with private IP address: 172.31.21.133)</h3>

<p>I attached an IAM Role to my EC2 instance B with following IAM policy (To write metric, at least to ensure you have <code class="language-plaintext highlighter-rouge">aps:RemoteWrite</code> permission, as <code class="language-plaintext highlighter-rouge">AmazonPrometheusRemoteWriteAccess</code>), this can allow AWS SigV4 proxy can use the permission and writes metrics to AMP:</p>

<div class="language-json highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="p">{</span><span class="w">
    </span><span class="nl">"Version"</span><span class="p">:</span><span class="w"> </span><span class="s2">"2012-10-17"</span><span class="p">,</span><span class="w">
    </span><span class="nl">"Statement"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
        </span><span class="p">{</span><span class="w">
            </span><span class="nl">"Effect"</span><span class="p">:</span><span class="w"> </span><span class="s2">"Allow"</span><span class="p">,</span><span class="w">
            </span><span class="nl">"Action"</span><span class="p">:</span><span class="w"> </span><span class="p">[</span><span class="w">
                </span><span class="s2">"aps:RemoteWrite"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"aps:QueryMetrics"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"aps:GetSeries"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"aps:GetLabels"</span><span class="p">,</span><span class="w">
                </span><span class="s2">"aps:GetMetricMetadata"</span><span class="w">
            </span><span class="p">],</span><span class="w">
            </span><span class="nl">"Resource"</span><span class="p">:</span><span class="w"> </span><span class="s2">"*"</span><span class="w">
        </span><span class="p">}</span><span class="w">
    </span><span class="p">]</span><span class="w">
</span><span class="p">}</span><span class="w">
</span></code></pre></div></div>

<p>When your Prometheus server is ingesting metrics on your EC2 instance B, to secure the ingestion, it is requires to use SigV4 authentication when writing metrics to AMP. However, the Prometheus server generally only can use basic auth to do Authorization for <code class="language-plaintext highlighter-rouge">remote_write</code>. Therefore, it is required to run a SigV4 proxy to provide access on port <code class="language-plaintext highlighter-rouge">8005</code> when forwarding remote write traffic.</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>docker run <span class="nt">-d</span> <span class="nt">-p</span> 8005:8005 public.ecr.aws/aws-observability/aws-sigv4-proxy:1.0 <span class="nt">--name</span> aps <span class="nt">--region</span> us-east-1 <span class="nt">--host</span> aps-workspaces.us-east-1.amazonaws.com <span class="nt">--port</span> :8005
</code></pre></div></div>

<p>So the proxy will provide service on port <code class="language-plaintext highlighter-rouge">8005</code> and can be accessed via <code class="language-plaintext highlighter-rouge">localhost:8005</code> or <code class="language-plaintext highlighter-rouge">172.31.21.133:8005</code>.</p>

<p>Note: If you are not running resource in <code class="language-plaintext highlighter-rouge">us-east-1</code> region, replace option <code class="language-plaintext highlighter-rouge">--region us-east-1</code> and <code class="language-plaintext highlighter-rouge">--host aps-workspaces.us-east-1.amazonaws.com</code> as your own.</p>

<p>Once the SigV4 proxy is up and running, I am going to run a sample Go applcation:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ git clone https://github.com/sysdiglabs/custom-metrics-examples
$ docker build custom-metrics-examples/prometheus/golang -t prometheus-golang
$ docker run -d --rm --name prometheus-golang -p 80:8080 prometheus-golang
</code></pre></div></div>

<p>The Go application will expose the metric with path<code class="language-plaintext highlighter-rouge">/metrics</code>, so I can query them if using <code class="language-plaintext highlighter-rouge">curl</code>:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl http://localhost/metrics | head

# HELP go_gc_duration_seconds A summary of the GC invocation durations.-     0
# TYPE go_gc_duration_seconds summary
go_gc_duration_seconds{quantile="0"} 2.9336e-05
go_gc_duration_seconds{quantile="0.25"} 3.1688e-05
go_gc_duration_seconds{quantile="0.5"} 3.459e-05
go_gc_duration_seconds{quantile="0.75"} 4.1515e-05
go_gc_duration_seconds{quantile="1"} 8.7687e-05
go_gc_duration_seconds_sum 0.00251097
go_gc_duration_seconds_count 62
...
</code></pre></div></div>

<h3 id="5-set-up-the-prometheus-server-to-collect-metrics">5) Set up the Prometheus server to collect metrics</h3>

<p>I created a configuration for Prometheus and scrape metric for Prometheus server itself (<code class="language-plaintext highlighter-rouge">http://localhost:9090/metrics</code>) and my Go application (Go application will expose metric through <code class="language-plaintext highlighter-rouge">172.31.21.133:80/metrics</code>):</p>

<ul>
  <li><a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/#remote_write">remote_write</a>: The section below can send metric to the remote endpoint. In this case, the url need to be specified through SigV4 proxy.</li>
</ul>

<p>[conf.yml]</p>

<div class="language-yaml highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c1">#global config</span>
<span class="na">global</span><span class="pi">:</span>
  <span class="na">scrape_interval</span><span class="pi">:</span>     <span class="s">15s</span>
  <span class="na">evaluation_interval</span><span class="pi">:</span> <span class="s">5s</span>
  <span class="na">scrape_timeout</span><span class="pi">:</span>     <span class="s">10s</span>
  <span class="na">external_labels</span><span class="pi">:</span>
    <span class="na">monitor</span><span class="pi">:</span> <span class="s1">'</span><span class="s">monitor'</span>

<span class="c1"># Scrape configs only contain one scrape target</span>
<span class="na">scrape_configs</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">job_name</span><span class="pi">:</span> <span class="s1">'</span><span class="s">prometheus'</span>
    <span class="c1"># Override the global default and scrape targets from this job every 5 seconds.</span>
    <span class="na">scrape_interval</span><span class="pi">:</span> <span class="s">5s</span>
    <span class="na">static_configs</span><span class="pi">:</span>
      <span class="pi">-</span> <span class="na">targets</span><span class="pi">:</span> <span class="pi">[</span><span class="s1">'</span><span class="s">localhost:9090'</span><span class="pi">,</span> <span class="s1">'</span><span class="s">172.31.21.133:80'</span><span class="pi">]</span>
<span class="na">remote_write</span><span class="pi">:</span>
  <span class="pi">-</span> <span class="na">url</span><span class="pi">:</span> <span class="s1">'</span><span class="s">http://172.31.21.133:8005/workspaces/ws-XXXXXX-XXXX-XXX-XXXX-XXXXXXX/api/v1/remote_write'</span>
</code></pre></div></div>

<p>Then, start the Prometheus server to scrape metric:</p>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ docker run \
     -p 9090:9090 \
     -v $PWD/conf.yml:/etc/prometheus/prometheus.yml \
     prom/prometheus
</code></pre></div></div>

<p>Once the Prometheus server is up and running, you would expect to see targets and know the health status:</p>

<figure class="">
  <img src="/assets/images/posts/2021/02/run-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp/prometheus-targets.png" alt="Prometheus targets" />
  
    <figcaption>
      Prometheus targets

    </figcaption>
  
</figure>

<h3 id="5-view-the-metric-">5) View the metric !</h3>

<p>Right now, if the Prometheus server can correctly write metric through AWS SigV4 Proxy, you would expect to view the metrics on Grafana dashboard:</p>

<figure class="">
  <img src="/assets/images/posts/2021/02/run-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp/grafana-dashboard-view-amp-metric.png" alt="View collected metrics on AMP in Grafana dashboard" />
  
    <figcaption>
      View collected metrics on AMP in Grafana dashboard

    </figcaption>
  
</figure>

<h2 id="troubleshooting">Troubleshooting</h2>

<h3 id="how-to-use-curl-to-query-my-amazon-prometheus-to-check-if-the-connectivity-or-iam-authentication-is-working-or-not">How to use curl to query my Amazon Prometheus to check if the connectivity, or, IAM authentication is working or not?</h3>

<p>To test the Sigv4, you can run the proxy and test the function with <code class="language-plaintext highlighter-rouge">curl</code> command. If you also would like to specify the IAM credential, choose either one of method to test the proxy and see if it can route the traffic for you:</p>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="c"># Env vars</span>
<span class="nv">$ </span>docker run <span class="nt">--rm</span> <span class="nt">-ti</span> <span class="se">\</span>
  <span class="nt">-e</span> <span class="s1">'AWS_ACCESS_KEY_ID=&lt;YOUR ACCESS KEY ID&gt;'</span> <span class="se">\</span>
  <span class="nt">-e</span> <span class="s1">'AWS_SECRET_ACCESS_KEY=&lt;YOUR SECRET ACCESS KEY&gt;'</span> <span class="se">\</span>
  <span class="nt">-p</span> 8005:8005 <span class="se">\</span>
  public.ecr.aws/aws-observability/aws-sigv4-proxy:1.0 <span class="nt">--name</span> aps <span class="nt">--region</span> us-east-1 <span class="nt">--host</span> aps-workspaces.us-east-1.amazonaws.com <span class="nt">--port</span> :8005

<span class="c"># Shared Credentials</span>
<span class="nv">$ </span>docker run <span class="nt">--rm</span> <span class="nt">-ti</span> <span class="se">\</span>
  <span class="nt">-v</span> ~/.aws:/root/.aws <span class="se">\</span>
  <span class="nt">-p</span> 8005:8005 <span class="se">\</span>
  <span class="nt">-e</span> <span class="s1">'AWS_PROFILE=&lt;SOME PROFILE&gt;'</span> <span class="se">\</span>
  public.ecr.aws/aws-observability/aws-sigv4-proxy:1.0 <span class="nt">--name</span> aps <span class="nt">--region</span> us-east-1 <span class="nt">--host</span> aps-workspaces.us-east-1.amazonaws.com <span class="nt">--port</span> :8005
</code></pre></div></div>

<p>Once the <code class="language-plaintext highlighter-rouge">aws-sigv4-proxy</code> is up and running, you can simply to use <code class="language-plaintext highlighter-rouge">curl</code> to test the local endpoint:</p>

<ul>
  <li>An example with normal request but did not have query:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl http://localhost:8005/workspaces/ws-XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX/api/v1/query <span class="nt">-vvv</span>

<span class="k">*</span>   Trying 127.0.0.1...
<span class="k">*</span> TCP_NODELAY <span class="nb">set</span>
<span class="k">*</span> Connected to localhost <span class="o">(</span>127.0.0.1<span class="o">)</span> port 8005 <span class="o">(</span><span class="c">#0)</span>
<span class="o">&gt;</span> GET /workspaces/ws-XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX/api/v1/query HTTP/1.1
<span class="o">&gt;</span> Host: localhost:8005
<span class="o">&gt;</span> User-Agent: curl/7.53.1
<span class="o">&gt;</span> Accept: <span class="k">*</span>/<span class="k">*</span>
<span class="o">&gt;</span>
&lt; HTTP/1.1 400 Bad Request
&lt; Content-Type: application/json
&lt; Date: Tue, 09 Feb 2021 15:02:56 GMT
&lt; Server: amazon
&lt; X-Amzn-Requestid: XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
&lt; Content-Length: 125
&lt;
<span class="k">*</span> Connection <span class="c">#0 to host localhost left intact</span>
<span class="o">{</span><span class="s2">"status"</span>:<span class="s2">"error"</span>,<span class="s2">"errorType"</span>:<span class="s2">"bad_data"</span>,<span class="s2">"error"</span>:<span class="s2">"invalid parameter 'query': 1:1: parse error: no expression found in input"</span><span class="o">}</span>
</code></pre></div></div>

<ul>
  <li>An example with normal request by feeding query according to <a href="https://prometheus.io/docs/prometheus/latest/querying/api/">HTTP API</a>:</li>
</ul>

<div class="language-plaintext highlighter-rouge"><div class="highlight"><pre class="highlight"><code>$ curl http://localhost:8005/workspaces/ws-XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX/api/v1/query?query=up -vvv

*   Trying 127.0.0.1...
* TCP_NODELAY set
* Connected to localhost (127.0.0.1) port 8005 (#0)
&gt; GET /workspaces/ws-XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX/api/v1/query?query=up HTTP/1.1
&gt; Host: localhost:8005
&gt; User-Agent: curl/7.53.1
&gt; Accept: */*
&gt;
&lt; HTTP/1.1 200 OK
&lt; Content-Type: application/json
&lt; Date: Tue, 09 Feb 2021 15:10:49 GMT
&lt; Server: amazon
&lt; X-Amzn-Requestid: XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX
&lt; Content-Length: 63
&lt;
* Connection #0 to host localhost left intact
{"status":"success","data":{"resultType":"vector","result":[]}}
</code></pre></div></div>

<ul>
  <li>An example with failed response due to lack of IAM permission(<code class="language-plaintext highlighter-rouge">aps:QueryMetrics</code>) for my IAM user/role:</li>
</ul>

<div class="language-bash highlighter-rouge"><div class="highlight"><pre class="highlight"><code><span class="nv">$ </span>curl http://localhost:8005/workspaces/ws-XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX/api/v1/query <span class="nt">-vvv</span>

<span class="k">*</span>   Trying 127.0.0.1...
<span class="k">*</span> TCP_NODELAY <span class="nb">set</span>
<span class="k">*</span> Connected to localhost <span class="o">(</span>127.0.0.1<span class="o">)</span> port 8005 <span class="o">(</span><span class="c">#0)</span>
<span class="o">&gt;</span> GET /workspaces/ws-XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX/api/v1/query HTTP/1.1
<span class="o">&gt;</span> Host: localhost:8005
<span class="o">&gt;</span> User-Agent: curl/7.53.1
<span class="o">&gt;</span> Accept: <span class="k">*</span>/<span class="k">*</span>
<span class="o">&gt;</span>
&lt; HTTP/1.1 403 Forbidden
&lt; Content-Length: 200
&lt; Content-Type: application/json
&lt; Date: Tue, 09 Feb 2021 15:07:55 GMT
&lt; Server: amazon
&lt; X-Amzn-Errortype: AccessDeniedException
&lt; X-Amzn-Requestid: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
&lt; X-Amzn-Requestid: xxxxxxxx-xxxx-xxxx-xxxx-xxxxxxxxxxxx
&lt;
<span class="k">*</span> Connection <span class="c">#0 to host localhost left intact</span>
<span class="o">{</span><span class="s2">"Message"</span>:<span class="s2">"User: arn:aws:iam::111111111111:user/myIAMUser is not authorized to perform: aps:QueryMetrics on resource: arn:aws:aps:us-east-1:111111111111:workspace/ws-XXXXXXXX-XXXX-XXXX-XXXX-XXXXXXXXXXXX"</span><span class="o">}</span>
</code></pre></div></div>

<h2 id="conclusion">Conclusion</h2>

<p>In this article, it shows a example to use Amazon Managed Service for Prometheus (AMP) to gather metrics when running standalone application on EC2 instance, rather than having Kubernetes to deploy. As it might be difficult to understand what things need to be noticed, so I shared configuration and steps. Giving the overview and share some tips you have to know if you are trying to push metrics to AMP.</p>

<h2 id="references">References</h2>

<ul>
  <li><a href="https://www.youtube.com/watch?v=fW2LOqHDUNM">Demo Video - Amazon Managed Service for Prometheus (AMP) &amp; Amazon Managed Service for Grafana (AMG)</a></li>
  <li><a href="https://github.com/awslabs/aws-sigv4-proxy">AWS SigV4 Proxy</a></li>
  <li><a href="https://prometheus.io/docs/prometheus/latest/configuration/configuration/">Prometheus configuration</a></li>
</ul>

        
      </section>

      <footer class="page__meta">
        
        
  


  
  
  

  <p class="page__taxonomy">
    <strong><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags: </strong>
    <span itemprop="keywords">
    
      
      
      <a href="/tags/#amazon-managed-service-for-prometheus" class="page__taxonomy-item" rel="tag">Amazon Managed Service for Prometheus</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#amazon-web-services" class="page__taxonomy-item" rel="tag">amazon web services</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#amazon" class="page__taxonomy-item" rel="tag">amazon</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#amp" class="page__taxonomy-item" rel="tag">AMP</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#aws" class="page__taxonomy-item" rel="tag">aws</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#ec2" class="page__taxonomy-item" rel="tag">EC2</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#elastic-compute-cloud" class="page__taxonomy-item" rel="tag">Elastic Compute Cloud</a><span class="sep">, </span>
    
      
      
      <a href="/tags/#prometheus" class="page__taxonomy-item" rel="tag">Prometheus</a>
    
    </span>
  </p>




        
  <p class="page__date"><strong><i class="fas fa-fw fa-calendar-alt" aria-hidden="true"></i> Updated:</strong> <time datetime="2021-02-01T00:00:00+00:00">February 1, 2021</time></p>


      </footer>

      <section class="page__share">
  
    <h4 class="page__share-title">Share on</h4>
  

  <a href="https://twitter.com/intent/tweet?text=Run+application+on+EC2+and+gather+metric+to+Amazon+Managed+Service+for+Prometheus+%28Amazon+Prometheus+%2F+AMP%29%20https%3A%2F%2Feasoncao.com%2Frun-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp%2F" class="btn btn--twitter" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Twitter"><i class="fab fa-fw fa-twitter" aria-hidden="true"></i><span> Twitter</span></a>

  <a href="https://www.facebook.com/sharer/sharer.php?u=https%3A%2F%2Feasoncao.com%2Frun-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp%2F" class="btn btn--facebook" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on Facebook"><i class="fab fa-fw fa-facebook" aria-hidden="true"></i><span> Facebook</span></a>

  <a href="https://www.linkedin.com/shareArticle?mini=true&url=https%3A%2F%2Feasoncao.com%2Frun-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp%2F" class="btn btn--linkedin" onclick="window.open(this.href, 'window', 'left=20,top=20,width=500,height=500,toolbar=1,resizable=0'); return false;" title="Share on LinkedIn"><i class="fab fa-fw fa-linkedin" aria-hidden="true"></i><span> LinkedIn</span></a>
</section>


      
      <iframe
        style="width: 100%; max-width: 485px; height: 170px; margin: auto; overflow: hidden; display: block;"
        src="https://button.like.co/in/embed/easoncao/button?referrer=https%3A%2F%2Feasoncao.com%2Frun-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp%2F" frameBorder="0">
      </iframe>
      

      
  <nav class="pagination">
    
      <a href="/coredns-resolution-truncation-issue-on-kubernetes-kube-dns/" class="pagination--pager" title="CoreDNS(kube-dns) resolution truncation issue on Kubernetes (Amazon EKS)
">Previous</a>
    
    
      <a href="/using-aws-lambda-and-amazon-sns-to-get-file-change-notifications-from-aws-codecommit/" class="pagination--pager" title="身為 DevOps 你會想知道的 AWS 技巧 - 使用 AWS Lambda 和 Amazon SNS 取得來自 AWS CodeCommit (Git) 的檔案變更通知
">Next</a>
    
  </nav>

    </div>

    
      <div class="page__comments">
  
  
      <h4 class="page__comments-title">Leave a comment</h4>
      <section id="disqus_thread"></section>
    
</div>

    
  </article>

  

  <!-- Google Adsense -->
  <div class="page__related">
    <h4 class="page__related-title">You May Also Have Interest</h4>
    <div>
        <!-- responsive ad -->
        <ins class="adsbygoogle"
             style="display:block"
             data-ad-client="ca-pub-1852752964062281"
             data-ad-slot="2849626059"
             data-ad-format="auto"
             data-full-width-responsive="true"></ins>
        <script>
             (adsbygoogle = window.adsbygoogle || []).push({});
        </script>
    </div>
  </div>

  
    <div class="page__related">
      <h4 class="page__related-title">You may also enjoy</h4>
      <div class="grid__wrapper">
        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/posts/2021/02/what-is-cloud-support-engineer-doing-in-amazon/amazon-bear-chen.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/what-is-cloud-support-engineer-doing-in-amazon/" rel="permalink">Amazon 的 Cloud Support Engineer 到底是在做什麼 (Amazon Web Services / AWS)
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">AWS Cloud Support Engineer 主要面向的客戶受眾便是使用 AWS (Amazon Web Services) 服務的客戶，並為這些客戶提供訂閱制的支持計畫。(沒錯，也就是說，我們是付費的服務。)
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/posts/2021/02/ten-thing-I-learned-in-amazon/day-1.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/ten-thing-I-learned-in-amazon/" rel="permalink">我在 Amazon 學到的 10 件事
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  3 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">
  
  
    
      Every day is day 1

    
  

</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/posts/2021/02/how-i-pass-aws-all-five-certificate-within-one-year/certificate-path.png" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/how-i-pass-aws-all-five-certificate-within-one-year/" rel="permalink">我是如何在一年內通過 AWS 五大核心認證
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  1 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">這是我在 2019 年與同事們分享的內容。當時我們團隊，只有少數人有去考 Solution Architect Associate。而我，是還在當實習生的時候，在短短一年內，通過 AWS 五張主要的核心認證 (All five)：
</p>
  </article>
</div>

        
          



<div class="grid__item">
  <article class="archive__item" itemscope itemtype="https://schema.org/CreativeWork">
    
      <div class="archive__item-teaser">
        <img src="/assets/images/posts/2021/02/how-am-I-get-into-amazon-before-graduate/amazon-macaron.jpg" alt="">
      </div>
    
    <h2 class="archive__item-title no_toc" itemprop="headline">
      
        <a href="/how-am-I-get-into-amazon-before-graduate/" rel="permalink">我是如何在還沒畢業就錄取並進入到 Amazon 工作
</a>
      
    </h2>
    
      <p class="page__meta"><i class="far fa-clock" aria-hidden="true"></i> 




  2 minute read

</p>
    
    <p class="archive__item-excerpt" itemprop="description">很多人好奇我是如何進到 Amazon 工作，並且在還沒畢業前就拿到 offer。今年 (2021) 是我加入 Amazon 這家公司的第三年 (把當 Intern 跟當兵的時間也算進去的話 XD)，所以一次把故事寫在這裡。
</p>
  </article>
</div>

        
      </div>
    </div>
  
  
</div>

    </div>

    
      <div class="search-content">
        <div class="search-content__inner-wrap"><form class="search-content__form" onkeydown="return event.key != 'Enter';">
    <label class="sr-only" for="search">
      Enter your search term...
    </label>
    <input type="search" id="search" class="search-input" tabindex="-1" placeholder="Enter your search term..." />
  </form>
  <div id="results" class="results"></div></div>

      </div>
    

    <div id="footer" class="page__footer">
      <footer>
        <!-- start custom footer snippets -->

<!-- end custom footer snippets -->
        <div class="page__footer-follow">
  <ul class="social-icons">
    
      <li><strong>Follow:</strong></li>
    

    
      
        
      
        
      
        
      
        
      
        
      
        
      
    

    <li><a href="/feed.xml"><i class="fas fa-fw fa-rss-square" aria-hidden="true"></i> Feed</a></li>
    <li><a href="/sitemap.xml"><i class="fas fa-fw fa-sitemap" aria-hidden="true"></i> SiteMap</a></li>
    <li><a href="/tags"><i class="fas fa-fw fa-tags" aria-hidden="true"></i> Tags</a></li>
    <li><a href="https://toolbox.easoncao.com/"><i class="fas fa-fw fa-toolbox" aria-hidden="true"></i> ToolBox</a></li>
  </ul>
</div>

<div class="page__footer-copyright">&copy; 2021 Continuous Improvement. Powered by <a href="https://jekyllrb.com" rel="nofollow">Jekyll</a>.</div>

      </footer>
    </div>

    
  <script src="/assets/js/main.min.js"></script>




<script src="/assets/js/lunr/lunr.min.js"></script>
<script src="/assets/js/lunr/lunr-store.js"></script>
<script src="/assets/js/lunr/lunr-en.js"></script>




  <script>
  var _gaq = _gaq || [];
  _gaq.push(['_setAccount', 'UA-80058083-2']);
  
  _gaq.push(['_trackPageview']);

  (function() {
    var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
    ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
    var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
  })();
</script>






    
  <script>
    var disqus_config = function () {
      this.page.url = "https://easoncao.com/run-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp/";  /* Replace PAGE_URL with your page's canonical URL variable */
      this.page.identifier = "/run-app-on-ec2-and-gather-metric-to-amazon-prometheus-amp"; /* Replace PAGE_IDENTIFIER with your page's unique identifier variable */
    };
    (function() { /* DON'T EDIT BELOW THIS LINE */
      var d = document, s = d.createElement('script');
      s.src = 'https://lenlabs.disqus.com/embed.js';
      s.setAttribute('data-timestamp', +new Date());
      (d.head || d.body).appendChild(s);
    })();
  </script>
<noscript>Please enable JavaScript to view the <a href="https://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript>


  





  </body>
</html>
